<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
    <script src="../views/index.ejs" defer></script>
    <script src="../views/static/js/index.js" defer></script>
    <script type="text/javascript" src="./static/js/sign-in.js"></script>
    <title>배달의 팔족</title>
  </head>
  <body>
    <!-- header -->
    <%- include('includes/header') %>
    <!-- main -->
    <main class="sign-page">
      <% if (userType === 'clients') { %>
      <%- include('includes/signup-client') %>

      <% } else if (userType === 'owners') { %>
      <%- include('includes/signup-owner') %>
      <% } %>
    </main>
    <!-- footer -->
    <%- include('includes/footer') %>
    <script>
      const authEmailBtn = document.getElementById('sign-up-btn');
      const inputEmail = document.getElementById('sign-in-email');

      const inputAuthNum = document.getElementById('email-confirm');
      const confirmBtn = document.getElementById('confirm-btn');

      const resendBtn = document.getElementById('resend-btn');

      const signupClient = document.getElementById('form-client');
      const signupOwner = document.getElementById('form-owner');

      console.log('authEmailBtn = ', authEmailBtn);

      // 인증번호를 보내는 버튼
      authEmailBtn.addEventListener('click', () => {
        this.sendAuthNum();
      });

      // 인증확인 버튼
      confirmBtn.addEventListener('click', () => {
        this.authEmail();
      });

      // 인증번호 이메일로 다시 보내기
      resendBtn.addEventListener('click', () => {
        if (inputEmail.value) {
          this.sendAuthNum(inputEmail.value);
        }
      });

      if (signupClient) {
        signupClient.addEventListener('submit', sendClientData);
      }
      if (signupOwner) {
        signupOwner.addEventListener('submit', sendOwnerData);
      }

      // 유저회원가입
      // if() {

      // }
      // 오너회원가입

      // 이메일인증 api에 전달
      async function sendAuthNum() {
        console.log('인증번호 보내기');
        const res = await fetch('/auth/mail', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: inputEmail.value,
          }),
        });
        const data = await res.json();
        console.log('res = ', data);
      }
      async function authEmail() {
        console.log('인증번호 확인');
        const res = await fetch('/auth/mail-num', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            inputAuthNum: inputAuthNum.value,
          }),
        });
        const data = await res.json();
        console.log('res = ', data);
      }

      async function sendClientData() {
        console.log('sendClientData');
        event.preventDefault();
        const name = document.getElementById('sign-in-name');
        const password = document.getElementById('sign-in-pw');
        const confirmPassword = document.getElementById('sign-in-pw-confirm');
        const res = await fetch('/signup/clients', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: inputEmail.value,
            name: name.value,
            password: password.value,
            confirm: confirmPassword.value,
          }),
        });
        const data = await res.json();
        console.log('res = ', data);
        if (data.message === '회원가입이 완료되었습니다.') {
          window.location.href = '/sign-in/user';
        }
      }
      async function sendOwnerData() {
        console.log('sendOwnerData');
        event.preventDefault();
        const name = document.getElementById('sign-in-name');
        const password = document.getElementById('sign-in-pw');
        const confirmPassword = document.getElementById('sign-in-pw-confirm');
        const ownerName = document.getElementById('sign-in-owner-name');
        const ownerNum = document.getElementById('sign-in-owner-num');
        const res = await fetch('/signup/owner', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: inputEmail.value,
            name: name.value,
            password: password.value,
            confirm: confirmPassword.value,
            owner_name: ownerName.value,
            owner_number: ownerNum.value,
            point: 0,
          }),
        });
        const data = await res.json();
        console.log('res = ', data);
        if (data.message === '회원가입이 완료되었습니다.') {
          window.location.href = '/sign-in/owner';
        }
      }
    </script>
  </body>
</html>
